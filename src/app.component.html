<main class="container mx-auto p-4 sm:p-6 md:p-8">
  <div class="max-w-4xl mx-auto relative">
    
    <!-- Header -->
    <header class="text-center mb-8">
      <h1 class="text-4xl sm:text-5xl font-bold text-slate-800">{{ 'app.title' | translate }}</h1>
      <p class="mt-2 text-lg text-slate-600">{{ 'app.subtitle' | translate }}</p>
    </header>

    <!-- Language Switcher -->
    <div class="absolute top-0 right-0 text-sm font-medium">
        <button (click)="i18n.setLanguage('en')" 
                [class]="'px-2 py-1 rounded-md transition ' + (i18n.currentLang() === 'en' ? 'bg-sky-100 text-sky-700 font-bold' : 'text-slate-500 hover:bg-slate-100')">EN</button>
        <span class="mx-1 text-slate-300">|</span>
        <button (click)="i18n.setLanguage('es')" 
                [class]="'px-2 py-1 rounded-md transition ' + (i18n.currentLang() === 'es' ? 'bg-sky-100 text-sky-700 font-bold' : 'text-slate-500 hover:bg-slate-100')">ES</button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Left Panel: Calculator Inputs -->
      <div class="lg:col-span-2 bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
        <div class="space-y-6">
          
          <div>
            <label for="country" class="block text-sm font-medium text-slate-700 mb-1">{{ 'form.country' | translate }}</label>
            <select id="country" [value]="selectedCountryCode()" (change)="onCountryChange($event)" class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
              @for (country of countries(); track country.countryCode) {
                <option [value]="country.countryCode">{{ country.countryName }}</option>
              }
            </select>
             <p class="mt-2 text-xs text-slate-500 italic">{{ 'result.tooltip' | translate }}</p>
          </div>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div>
              <label for="start-date" class="block text-sm font-medium text-slate-700 mb-1">{{ 'form.startDate' | translate }}</label>
              <input type="date" id="start-date" [value]="startDateString()" (input)="onStartDateChange($event)" class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
            </div>
            <div>
              <label for="working-days" class="block text-sm font-medium text-slate-700 mb-1">{{ 'form.workingDays' | translate }}</label>
              <input type="number" id="working-days" min="0" [value]="workingDays()" (input)="onWorkingDaysChange($event)" class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
            </div>
          </div>
          
          <!-- Result Display -->
          @if (resultDate(); as date) {
            <div class="bg-sky-50 border-l-4 border-sky-500 p-4 rounded-md">
              <h3 class="text-lg font-semibold text-slate-800">{{ 'form.result' | translate }}</h3>
              <p class="text-3xl font-bold text-sky-600 mt-1">
                {{ date | date:'fullDate' }}
              </p>
              <p class="text-xs text-slate-500 mt-2">{{ 'result.note' | translate:{ start: startDateString(), country: selectedCountryConfig()?.countryName } }}</p>

              <!-- Contrast and Excluded Days -->
              <div class="mt-4 text-sm text-slate-600 border-t pt-3 space-y-3">
                <p>
                  <span class="font-medium">{{ 'form.plainDaysContrast.label' | translate }}</span>
                  @if (plainDate(); as pDate) {
                    <span class="ml-2 font-mono">{{ pDate | date:'longDate' }}</span>
                  }
                  @if (dayDifference() !== 0) {
                    <span class="ml-2 inline-block px-2 py-0.5 rounded-full text-xs font-semibold"
                          [class]="dayDifference() > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                      {{ (dayDifference() > 0 ? 'form.plainDaysContrast.diff' : 'form.plainDaysContrast.diff_negative') | translate:{ n: abs(dayDifference()) } }}
                    </span>
                  }
                </p>
                <div>
                  <button (click)="toggleExcludedDays()" class="text-sky-600 hover:text-sky-800 text-sm font-medium flex items-center transition-colors">
                    <span>{{ (showExcludedDays() ? 'form.exclusions.toggleHide' : 'form.exclusions.toggleShow') | translate }}</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" 
                         [class]="'w-5 h-5 ml-1 transition-transform ' + (showExcludedDays() ? 'rotate-180' : '')">
                      <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                    </svg>
                  </button>
                  @if (showExcludedDays()) {
                    <div class="mt-2 border-t pt-2 max-h-40 overflow-y-auto pr-2">
                      @if (excludedDays().length > 0) {
                        <ul class="space-y-1">
                          @for (day of excludedDays(); track day.date) {
                            <li class="flex justify-between items-center text-xs p-1 rounded bg-slate-100">
                              <span class="font-mono text-slate-600">{{ day.date | date }}</span>
                              <span class="font-semibold text-slate-800 text-right">{{ day.reason === 'weekend' ? ('form.exclusions.weekend' | translate) : day.reason }}</span>
                            </li>
                          }
                        </ul>
                      } @else {
                        <p class="text-xs text-slate-500 italic">{{ 'form.exclusions.empty' | translate }}</p>
                      }
                    </div>
                  }
                </div>
              </div>
            </div>
          } @else {
             <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-md text-center">
              <p class="text-amber-700 font-medium">{{ 'result.invalidInput' | translate }}</p>
            </div>
          }

          <!-- Mock Ad & Reminder Section -->
          <div class="border-t border-slate-200 pt-6 space-y-4">
             <h3 class="text-lg font-semibold text-slate-800">{{ 'reminders.title' | translate }}</h3>
              <div class="flex items-center justify-between bg-slate-100 p-3 rounded-lg">
                <span class="font-medium text-slate-700">{{ 'reminders.credits' | translate }} <span class="text-2xl font-bold text-sky-600 align-middle">{{ reminderCredits() }}</span></span>
                <button (click)="watchAd()" class="px-4 py-2 bg-gradient-to-r from-teal-400 to-cyan-500 text-white font-semibold rounded-md shadow-md hover:from-teal-500 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 transition-transform transform hover:scale-105">
                  {{ 'reminders.watchAd' | translate }}
                </button>
              </div>

             <button (click)="addReminder()" [disabled]="reminderCredits() <= 0 || !resultDate()" 
                [class]="'w-full py-3 px-4 font-semibold rounded-md shadow-md transition-all ' + 
                         (reminderCredits() > 0 && resultDate() ? 'bg-sky-600 text-white hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500' 
                                                                : 'bg-slate-300 text-slate-500 cursor-not-allowed')">
              {{ 'reminders.addReminder' | translate }}
            </button>
             @if (showReminderSuccess()) {
              <div class="mt-2 text-center bg-green-100 text-green-800 p-2 rounded-md font-medium">
                {{ 'reminders.success' | translate }}
              </div>
            }
          </div>
        </div>
      </div>
      
      <!-- Right Panel: Holiday List -->
      <aside class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
        @if (selectedCountryConfig(); as config) {
          <h3 class="text-xl font-bold text-slate-800 mb-4 border-b pb-2">
            {{ 'holidays.title' | translate:{ country: config.countryName, year: startDateString().split('-')[0] } }}
          </h3>
        }
        @if (holidaysForDisplay().length > 0) {
          <div class="max-h-96 overflow-y-auto space-y-3 pr-2">
            @for (holiday of holidaysForDisplay(); track holiday.date) {
              <div class="flex justify-between items-center bg-slate-50 p-2 rounded-md">
                <span class="text-sm font-medium text-slate-700">{{ holiday.name }}</span>
                <span class="text-sm text-slate-500">{{ holiday.date | date:'MMM d' }}</span>
              </div>
            }
          </div>
        } @else {
           <p class="text-sm text-slate-500 text-center py-8">{{ 'holidays.none' | translate }}</p>
        }
      </aside>

    </div>
  </div>
</main>
